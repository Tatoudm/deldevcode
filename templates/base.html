<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}DelDevCode{% endblock %}</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>

  <body class="bg-slate-50 text-slate-900 flex flex-col min-h-screen">
    {% if nom %}
    <script>
      (function () {
        let banCheckInFlight = false;

        function checkBan() {
          if (banCheckInFlight) return;
          banCheckInFlight = true;

          fetch("/api/check_ban")
            .then((res) => res.json())
            .then((data) => {
              if (data.banned) {
                alert(
                  "Vous avez été banni : " +
                    (data.reason || "Aucune raison donnée"),
                );
                window.location.href = "/logout";
              }
            })
            .catch((err) => {
              console.error("Erreur check_ban:", err);
            })
            .finally(() => {
              banCheckInFlight = false;
            });
        }

        setInterval(checkBan, 30000);
        checkBan();
      })();
    </script>
    {% endif %}

    <header class="bg-white shadow-sm border-b border-slate-200">
      <div
        class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center"
      >
        <a href="/" class="flex items-center space-x-3">
          <img
            src="{{ url_for('static', filename='favicon.ico') }}"
            class="w-9 h-9 rounded-xl object-cover"
            alt="Logo"
          />
          <h1 class="text-xl md:text-2xl font-bold text-slate-800">
            DelDevCode
          </h1>
        </a>

        <nav>
          <ul class="flex items-center space-x-8 text-base font-medium">
            <li>
              <a
                href="/"
                class="text-slate-700 hover:text-emerald-600 transition"
                >Accueil</a
              >
            </li>

            {% if nom %}
            <li>
              <a
                href="{{ url_for('profil.profil') }}"
                class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-emerald-500/80 bg-white hover:bg-emerald-50 hover:border-emerald-500 transition"
              >
                <span class="text-lg">⚙️</span>
                <img
                  src="{{ url_for('static', filename='pdp/' ~ pdp) }}"
                  alt="Avatar"
                  class="w-9 h-9 rounded-full object-cover"
                />
              </a>
            </li>
            <li>
              <a
                href="/logout"
                class="px-4 py-1.5 rounded-md bg-emerald-600 text-white hover:bg-emerald-500 transition"
              >
                Déconnexion
              </a>
            </li>
            {% else %}
            <li>
              <a
                href="/login"
                class="text-slate-700 hover:text-emerald-600 transition"
                >Se connecter</a
              >
            </li>
            <li>
              <a
                href="/register"
                class="text-slate-700 hover:text-emerald-600 transition"
                >S'enregistrer</a
              >
            </li>
            {% endif %}
          </ul>
        </nav>
      </div>
    </header>

    <main class="flex-1 py-8 px-6">{% block content %} {% endblock %}</main>

    <footer class="bg-white border-t border-slate-200 mt-8">
      <div
        class="max-w-6xl mx-auto px-6 py-6 text-center text-sm text-slate-600"
      >
        <p>2025 • DelDevCode</p>
        <p class="mt-1">
          Contact :
          <a
            class="text-emerald-600 hover:underline"
            href="mailto:contact@deldevcode.org"
          >
            contact@deldevcode.org
          </a>
        </p>
      </div>
    </footer>
  </body>
</html>
