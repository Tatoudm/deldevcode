{% extends "base.html" %}

{% block title %}DDC Login{% endblock %}

{% block content %}

<div class="flex items-center justify-center min-h-[60vh]">
    <div class="w-full max-w-md bg-white border border-slate-200 rounded-2xl shadow-sm p-6 space-y-4">

        <h1 class="text-2xl font-bold text-slate-900 text-center">
            Vérification en deux étapes
        </h1>

        <p class="text-sm text-slate-600 text-center">
            Un code de connexion a été envoyé à ton adresse email.
            Entre-le ci-dessous pour terminer ta connexion.
        </p>

        {% if erreur %}
        <div class="bg-red-50 text-red-800 border border-red-200 px-3 py-2 rounded-lg text-sm">
            {{ erreur }}
        </div>
        {% endif %}

        
        <form method="POST" class="space-y-4">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="space-y-1">
                <label for="code" class="text-sm font-medium text-slate-700">
                    Code A2F
                </label>
                <input type="text" id="code" name="code" maxlength="6" autocomplete="one-time-code" class="w-full px-3 py-2 rounded-lg border border-slate-300 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" placeholder="123456">
                <p class="text-xs text-slate-500">
                    Le code est valable 10 minutes. Tu as 5 tentatives maximum.
                </p>
            </div>

            <button type="submit" class="w-full inline-flex items-center justify-center px-4 py-2.5 rounded-lg bg-emerald-600 text-white text-sm font-medium hover:bg-emerald-500 transition">
                Valider le code
            </button>
        </form>

        
        <form method="POST" action="{{ url_for('auth.resend_login_2fa') }}" class="pt-1">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button id="resend-btn" type="submit" disabled class="w-full inline-flex items-center justify-center px-4 py-2.5 rounded-lg bg-slate-200 text-slate-700 text-sm font-medium opacity-50 cursor-not-allowed transition">
                Renvoyer le code (30s)
            </button>
        </form>

        <p class="text-xs text-slate-500 text-center pt-2">
            Si tu n'as pas reçu de mail, vérifie tes spams. Tu peux aussi renvoyer le code après quelques secondes. Si tu ne recois toujours pas le mail, réessaie encore ou contacte le support (contact@deldevcode.org). 
        </p>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const btn = document.getElementById("resend-btn");
        if (!btn) return;

        let remaining = 30;
        const baseText = "Renvoyer le code";

        btn.textContent = `${baseText} (${remaining}s)`;

        const interval = setInterval(() => {
            remaining -= 1;

            if (remaining <= 0) {
                clearInterval(interval);
                btn.disabled = false;
                btn.classList.remove("opacity-50", "cursor-not-allowed");
                btn.classList.remove("bg-slate-200");
                btn.classList.add("bg-emerald-50", "text-emerald-700", "hover:bg-emerald-100");
                btn.textContent = baseText;
            } else {
                btn.textContent = `${baseText} (${remaining}s)`;
            }
        }, 1000);
    });
</script>

{% endblock %}
